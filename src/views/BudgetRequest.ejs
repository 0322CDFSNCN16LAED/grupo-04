<!DOCTYPE html>
<html lang="en">
  <%- include('./partials/head') %>

  <body>
    <%- include('./partials/header') %>

    <main class="imagen-fondo-mobile fx justify-center">
      <div class="grey-opacity budget-req budg-req-desk">
        <h2 class="text-center bolder mb-3">Solicitud de presupuesto</h2>
        <form
          action="/budget/request"
          method="POST"
          enctype="multipart/form-data"
        >
          <div class="mb-3">
            <label for="tituloSolicitud" class="mr-3 form-label">
              <h4 class="font-medium">Título del trabajo</h4>
            </label>
            <input
              class="form-control <%= locals.errors && errors.tituloSolicitud ? 'is-invalid' : null%>"
              type="text"
              name="tituloSolicitud"
              id="detalleSolicitud"
              value="<%= locals.oldData ? oldData.tituloSolicitud : null %>"
              placeholder="Título del trabajo"
            />
            <% if (locals.errors && errors.tituloSolicitud) { %>
              <div class="error-msg"><%= errors.tituloSolicitud.msg %></div>
            <% } %>
          </div>
          <div>
            <label for="ubicacion" class="mr-3 form-label">
              <h4 class="font-medium">Descripción del trabajo</h4>
            </label>
            <textarea 
              class="form-control <%= locals.errors && errors.detalleSolicitud ? 'is-invalid' : null%>"
              id="detalleSolicitud"
              name="detalleSolicitud"
              rows="3"
              placeholder="Detallá el trabajo a realizar"
            ><%= locals.oldData ? oldData.detalleSolicitud : null %></textarea>
            <% if (locals.errors && errors.detalleSolicitud) { %>
              <div class="error-msg"><%= errors.detalleSolicitud.msg %></div>
            <% } %>
          </div>
          <div class="mb-3 align-center">
            <label for="rubro" class="mt-3 form-label">
              <h4 class="font-medium ">Categoría</h4>
            </label>
            <select
              name="rubroNombre"
              class="form-select font-medium form-select-lg   <%= locals.errors && errors.rubroNombre ? 'is-invalid' : null%>"
              aria-label=".form-select-lg example"
            >
              <option value="">Seleccioná el profesional que necesitás</option>              
              <% for( let rubro of rubros ) { %>              
                <option value="<%= rubro.nombre  %>" <%= locals.oldData && (rubro.nombre === oldData.rubroNombre ? "selected" : null) %> ><%= rubro.nombre %> </option>              
                <% } %>
            </select>
            <% if (locals.errors && errors.rubroNombre) { %>
              <div class="error-msg"><%= errors.rubroNombre.msg %></div>
            <% } %>
          </div>
          <div class="mb-3">
            <label for="imgReferencia" class="mr-3 form-label">
              <h4 class="font-medium">Imágenes de referencia</h4>
            </label>
            <input
              class="form-control"
              name="imgReferencia"
              type="file"
              id="imgReferencia"
              multiple
            />
            <% if (locals.errors && errors.imgReferencia) { %>
            <div class="error-msg"><%= errors.imgReferencia.msg %></div>
            <% } %>
          </div>

          <div class="mb-3 align-center">
            <label for="urgenciaTrabajo" class="mr-3 form-label">
              <h4 class="font-medium">Fecha a realizar el trabajo</h4>
            </label>
            <select
              name="urgenciaTrabajo"
              class="form-select font-medium form-select-lg"
              aria-label=".form-select-lg example"
            >
            <% const urgencia = ["Lo antes posible","Esta semana","Este mes"] %> 
              <option value="">Elegí cuándo necesitas realizar el trabajo</option>
              <% for( let chosen of urgencia ) { %>              
                <option value="<%= chosen  %>" <%= locals.oldData && (chosen === oldData.urgenciaTrabajo ? "selected" : null) %> ><%= chosen %> </option>              
              <% } %>
            </select>
            <% if (locals.errors && errors.urgenciaTrabajo) { %>
              <div class="error-msg"><%= errors.urgenciaTrabajo.msg %></div>
            <% } %>                          
            </select>
          </div>
          <div>
            <label for="ubicacion" class="mr-3 form-label">
              <h4 class="font-medium">Ubicación</h4>
            </label>
            <textarea
              class="form-control <%= locals.errors && errors.ubicacion ? 'is-invalid' : null%>"
              id="ubicacion"
              name="ubicacion"
              rows="1"
              placeholder="Ingresá tu domicilio"
            ><%= locals.oldData ? oldData.ubicacion : null %></textarea>
            <% if (locals.errors && errors.ubicacion) { %>
              <div class="error-msg"><%= errors.ubicacion.msg %></div>
            <% } %>
          </div>

          <div class="fx justify-center mt-3">
            <button type="submit" class="primary-button">
              Enviar solicitud
            </button>
          </div>
        </form>
      </div>
    </main>

    <%- include('./partials/footer') %>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
